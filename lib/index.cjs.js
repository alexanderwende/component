"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var litHtml=require("lit-html");const SPACES=/\s+([\S])/g,CAMELS=/[a-z]([A-Z])/g;function kebabCase(t){let e;if(t){for(t=t.trim();e=SPACES.exec(t);)t=t.replace(e[0],"-"+e[1]),SPACES.lastIndex=0;for(;e=CAMELS.exec(t);)t=t.replace(e[0],e[0][0]+"-"+e[1]),CAMELS.lastIndex=0}return t?t.toLowerCase():t}const PROPERTY_REFLECTOR_ERROR=t=>new Error(`Error executing property reflector ${t}.`),PROPERTY_NOTIFIER_ERROR=t=>new Error(`Error executing property notifier ${t}.`);class CustomElement extends HTMLElement{constructor(){super(),this._updateRequest=Promise.resolve(!0),this._changedProperties=new Map,this._notifyingProperties=new Map,this._listenerDeclarations=[],this._isConnected=!1,this._hasRequestedUpdate=!1,this._isReflecting=!1,this._renderRoot=this.createRenderRoot(),console.log("constructed... ",this.constructor.name)}static get observedAttributes(){return[]}get isConnected(){return this._isConnected}createRenderRoot(){return this.constructor.shadow?this.attachShadow({mode:"open"}):this}adoptedCallback(){}connectedCallback(){console.log("connected... ",this.constructor.name),this._listen(),this.requestUpdate()}disconnectedCallback(){console.log("disconnected... ",this.constructor.name),this._unlisten()}attributeChangedCallback(t,e,r){e!==r&&this._reflectAttribute(t,e,r)}propertyChangedCallback(t,e,r){}template(){return litHtml.html``}render(){console.log("render()... ",this.constructor.name),litHtml.render(this.template(),this._renderRoot),this.renderCallback()}renderCallback(){console.log("rendered... ",this.constructor.name)}update(t){console.log("update()... ",t),this.render(),t.forEach((t,e)=>{const r=this._getPropertyDeclaration(e),o=this[e];if(r.reflectProperty)if("function"==typeof r.reflectProperty)try{r.reflectProperty.call(this,e,t,o)}catch(t){throw PROPERTY_REFLECTOR_ERROR(r.reflectProperty.toString())}else if("string"==typeof r.reflectProperty)try{this[r.reflectProperty](e,t,o)}catch(t){throw PROPERTY_REFLECTOR_ERROR(r.reflectProperty)}else this._reflectProperty(e,t,o)}),this._notifyingProperties.forEach((t,e)=>{const r=this._getPropertyDeclaration(e),o=this[e];if(r.notify)if("function"==typeof r.notify)try{r.notify.call(this,e,t,o)}catch(t){throw PROPERTY_NOTIFIER_ERROR(r.notify.toString())}else if("string"==typeof r.notify)try{this[r.notify](e,t,o)}catch(t){throw PROPERTY_NOTIFIER_ERROR(r.notify)}else this._notify(e,t,o)})}notifyChanges(t){const e=new Map(this._changedProperties);t();for(const[t,r]of this._changedProperties)e.has(t)&&e.get(t)===r||this._notifyingProperties.set(t,r)}_notify(t,e,r){const o=`${kebabCase(t)}-changed`;this.dispatchEvent(new CustomEvent(o,{composed:!0,detail:{property:t,previous:e,current:r}})),console.log(`notify ${o}...`)}_reflectProperty(t,e,r){const o=this._getPropertyDeclaration(t),s="string"==typeof o.attribute?o.attribute:kebabCase(t),n=o.converter.toAttribute(r);void 0!==n&&(null===n?this.removeAttribute(s):this.setAttribute(s,n))}_reflectAttribute(t,e,r){const o=this.constructor;if(!o.attributes.has(t))return void console.log(`observed attribute "${t}" not found... ignoring...`);const s=o.attributes.get(t),n=this._getPropertyDeclaration(s).converter.fromAttribute(r);this._isReflecting=!0,this[s]=n,this._isReflecting=!1}_listen(){this.constructor.listeners.forEach((t,e)=>{const r={event:t.event,options:t.options,listener:this[e].bind(this),target:t.target?"function"==typeof t.target?t.target():t.target:this};r.target.addEventListener(r.event,r.listener,r.options),this._listenerDeclarations.push(r)})}_unlisten(){this._listenerDeclarations.forEach(t=>{t.target.removeEventListener(t.event,t.listener,t.options)})}requestUpdate(t,e,r){if(console.log("requestUpdate()... ",this.constructor.name),this._isReflecting)return console.log("requestUpdate()... reflecting"),this._updateRequest;if(t){const o=this._getPropertyDeclaration(t);if(o){const{observe:s}=o;if(!s)return this._updateRequest;if(console.log(`requestUpdate()... ${t} observe: ${!!s}`),"function"==typeof s&&!s(e,r))return this._updateRequest;console.log(`requestUpdate()... ${t} changed`),this._changedProperties.set(t,e)}}return this._hasRequestedUpdate||this._enqueueUpdate(),this._updateRequest}_performUpdate(){return console.log("performUpdate()... ",this.constructor.name),new Promise(t=>{requestAnimationFrame(()=>{this.update(this._changedProperties),this._changedProperties=new Map,this._notifyingProperties=new Map,this._hasRequestedUpdate=!1,t()})})}async _enqueueUpdate(){let t;console.log("enqueueUpdate()... ",this.constructor.name);const e=this._updateRequest;this._hasRequestedUpdate=!0,this._updateRequest=new Promise(e=>t=e),await e;const r=this._performUpdate();await r,t(!this._hasRequestedUpdate)}_getPropertyDeclaration(t){return this.constructor.properties.get(t)}}CustomElement.attributes=new Map,CustomElement.properties=new Map,CustomElement.listeners=new Map;const ATTRIBUTE_CONVERTERS={default:{fromAttribute:t=>{if(null===t||""===t)return null;try{return JSON.parse(t)}catch(e){return t}},toAttribute:t=>{switch(typeof t){case"boolean":return t?"":null;case"object":return null==t?t:JSON.stringify(t);case"undefined":case"string":return t;default:return t.toString()}}},boolean:{fromAttribute:t=>null!==t,toAttribute:t=>t?"":null},string:{fromAttribute:t=>null===t?null:t,toAttribute:t=>t},number:{fromAttribute:t=>null===t?null:Number(t),toAttribute:t=>null==t?t:t.toString()},object:{fromAttribute:t=>null===t||""===t?null:JSON.parse(t),toAttribute:t=>null==t?t:JSON.stringify(t)},array:{fromAttribute:t=>null===t||""===t?null:JSON.parse(t),toAttribute:t=>null==t?t:JSON.stringify(t)},date:{fromAttribute:t=>null===t||""===t?null:new Date(t),toAttribute:t=>null==t?t:t.toString()}},DEFAULT_CUSTOM_ELEMENT_DECLARATION={selector:"",shadow:!0,define:!0},customElement=(t={})=>{const e=Object.assign({},DEFAULT_CUSTOM_ELEMENT_DECLARATION,t);return t=>{const r=t;r.selector=e.selector||t.selector,r.shadow=e.shadow;const o=[...new Set(r.observedAttributes.reduce((t,e)=>t.concat(r.overridden.has(e)?[]:e),[]).concat([...t.attributes.keys()]))];Reflect.defineProperty(r,"observedAttributes",{configurable:!0,enumerable:!1,get:()=>o}),e.define&&window.customElements.define(r.selector,r)}};function listener(t){return function(e,r,o){const s=e.constructor;prepareConstructor(s),s.listeners.set(r,Object.assign({},t))}}function prepareConstructor(t){t.hasOwnProperty("listeners")||(t.listeners=new Map(t.listeners))}function getPropertyDescriptor(t,e){if(e in t)for(;t!==Object.prototype;){if(t.hasOwnProperty(e))return Object.getOwnPropertyDescriptor(t,e);t=Object.getPrototypeOf(t)}}const DEFAULT_PROPERTY_CHANGE_DETECTOR=(t,e)=>t!==e&&(t==t||e==e),DEFAULT_PROPERTY_DECLARATION={attribute:!0,converter:ATTRIBUTE_CONVERTERS.default,reflectAttribute:!0,reflectProperty:!0,notify:!0,observe:DEFAULT_PROPERTY_CHANGE_DETECTOR},property=(t={})=>(e,r)=>{const o=getPropertyDescriptor(e,r),s="string"==typeof r?`_${r}`:Symbol(),n=o&&o.get||function(){return this[s]},i=o&&o.set||function(t){this[s]=t};Object.defineProperty(e,r,{configurable:!0,enumerable:!0,get(){return n.call(this)},set(t){const e=this[r];i.call(this,t),this.requestUpdate(r,e,t)}});const a=e.constructor,c=Object.assign({},DEFAULT_PROPERTY_DECLARATION,t);!0===c.attribute&&(c.attribute=kebabCase(r)),!0===c.observe&&(c.observe=DEFAULT_PROPERTY_DECLARATION.observe),prepareConstructor$1(a);const l=a.properties.has(r)?a.properties.get(r).attribute:void 0;l&&(a.attributes.delete(l),a.overridden.add(l)),c.attribute&&a.attributes.set(c.attribute,r),a.properties.set(r,c)};function prepareConstructor$1(t){t.hasOwnProperty("properties")||(t.properties=new Map(t.properties)),t.hasOwnProperty("attributes")||(t.attributes=new Map(t.attributes)),t.hasOwnProperty("overridden")||(t.overridden=new Set)}exports.lit=litHtml,exports.CustomElement=CustomElement,exports.ATTRIBUTE_CONVERTERS=ATTRIBUTE_CONVERTERS,exports.DEFAULT_CUSTOM_ELEMENT_DECLARATION=DEFAULT_CUSTOM_ELEMENT_DECLARATION,exports.customElement=customElement,exports.listener=listener,exports.property=property,exports.DEFAULT_PROPERTY_CHANGE_DETECTOR=DEFAULT_PROPERTY_CHANGE_DETECTOR,exports.DEFAULT_PROPERTY_DECLARATION=DEFAULT_PROPERTY_DECLARATION;
//# sourceMappingURL=index.cjs.js.map
